{"mappings":"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","sources":["frontend/editor/controls-section.js"],"sourcesContent":["let data;\n\n$('pull').addEventListener('click', pull);\n\nasync function pull() {\n\tif (\n\t\tdata\n\t\t&& !confirm(\n\t\t\t'This will overwrite any existing changes. Are you sure you want to continue?',\n\t\t)\n\t) {\n\t\treturn;\n\t}\n\n\tdata = await (await fetch('../api/v1/spec')).json();\n\tupdate_view();\n}\n\n$('push').addEventListener('click', async () => {\n\tconst res = await fetch('../api/v1/spec', {\n\t\tmethod: 'POST',\n\t\tbody: JSON.stringify(data),\n\t\theaders: {\n\t\t\tAuthorization,\n\t\t},\n\t});\n\tif (res.ok) {\n\t\talert('Saved!');\n\t} else {\n\t\talert(`Error: ${res.status} ${res.statusText}`);\n\t}\n});\n\n$('update').addEventListener('click', async () => {\n\tconst res = await fetch('../api/v1/update', {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\tAuthorization,\n\t\t},\n\t});\n\tif (res.ok) {\n\t\talert('Saved!');\n\t} else {\n\t\talert(`Error: ${res.status} ${res.statusText}`);\n\t}\n});\n\n$('select_schedule').addEventListener('change', () => {\n\tupdate_view();\n});\n\nlet schedule_name;\nlet period_index;\nlet schedule;\nlet period;\n\nfunction update_view() {\n\t// Fill drop-down menus\n\tschedule_name = $('select_schedule').value;\n\t$('select_schedule').innerHTML = '';\n\tfor (const schedule_type of Object.keys(data.schedule_types).sort((a, b) =>\n\t\tdata.schedule_types[a].friendly_name.localeCompare(\n\t\t\tdata.schedule_types[b].friendly_name,\n\t\t),\n\t)) {\n\t\t$(\n\t\t\t'select_schedule',\n\t\t).innerHTML += `<option value=\"${schedule_type}\">${data.schedule_types[schedule_type].friendly_name}</option>`;\n\t}\n\n\tif (!schedule_name) {\n\t\tschedule_name = $('select_schedule').value;\n\t}\n\n\t$('select_schedule').value = schedule_name;\n\t$('add_period').disabled = !schedule_name;\n\n\t// Load current data\n\tschedule = schedule_name && data.schedule_types[schedule_name];\n\n\tfor (const el of document.querySelectorAll('.schedule_setting')) {\n\t\tel.disabled = !schedule;\n\t}\n\n\tif (schedule) {\n\t\tdisplayPeriods();\n\t\t// Fill form fields\n\t\t$('schedule_friendly_name').value = schedule.friendly_name;\n\t\t$('schedule_code').value = schedule_name;\n\t\t$('schedule_color').value = `#${schedule.color\n\t\t\t.map(x => `0${x.toString(16)}`.slice(-2))\n\t\t\t.join('')}`;\n\t\t$('schedule_hide').checked = schedule.hide;\n\t\t$('schedule_regex').value = schedule.regex;\n\t} else {\n\t\t$('periods').innerHTML = '';\n\t}\n\n\t$('calendars').value = data.calendar_urls.slice().reverse().join('\\n') + '\\n';\n\t$('calendars').setAttribute('rows', $('calendars').value.match(/\\n/g).length + 1);\n\n\t$('typical_schedule').innerHTML = '';\n\n\tfor (const [i, day] of ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'].entries()) {\n\t\tconst label = document.createElement('label');\n\t\tlabel.innerHTML = day;\n\t\tlabel.setAttribute('for', `typical_schedule_${i}`);\n\t\t$('typical_schedule').append(label);\n\n\t\tconst select = document.createElement('select');\n\t\tselect.innerHTML = $('select_schedule').innerHTML;\n\t\tselect.value = data.typical_schedule[i];\n\t\tselect.addEventListener('change', () => {\n\t\t\tdata.typical_schedule[i] = select.value;\n\t\t});\n\t\t$('typical_schedule').append(select);\n\n\t\tconst br = document.createElement('br');\n\t\t$('typical_schedule').append(br);\n\t}\n}\n\n// Schedule add, copy, and remove\n$('add_schedule').addEventListener('click', () => {\n\tconst new_name = codeStr(\n\t\tprompt(\n\t\t\t'Set the internal name for the new schedule type (like no_school or orange_day)',\n\t\t),\n\t);\n\tif (data.schedule_types[new_name]) {\n\t\treturn alert('A schedule already exists with this code.');\n\t}\n\n\tif (!new_name) {\n\t\treturn;\n\t}\n\n\tdata.schedule_types[new_name] = {\n\t\tfriendly_name: 'New Schedule',\n\t\tperiods: [],\n\t\tregex: '',\n\t\tcolor: [255, 255, 255],\n\t\thide: false,\n\t};\n\n\tupdate_view();\n\t$('select_schedule').value = new_name;\n\tupdate_view();\n});\n$('copy_schedule').addEventListener('click', () => {\n\tconst new_name = codeStr(\n\t\tprompt(\n\t\t\t'Set the internal name for the newly copied schedule (like no_school or orange_day)',\n\t\t),\n\t);\n\tif (data.schedule_types[new_name]) {\n\t\treturn alert('A schedule already exists with this code.');\n\t}\n\n\tif (!new_name) {\n\t\treturn;\n\t}\n\n\tdata.schedule_types[new_name] = Object.assign(\n\t\t{},\n\t\tdata.schedule_types[schedule_name],\n\t);\n\tdata.schedule_types[new_name].friendly_name = `Copy of ${schedule_name}`;\n\n\tupdate_view();\n\t$('select_schedule').value = new_name;\n\tupdate_view();\n});\n$('remove_schedule').addEventListener('click', () => {\n\tconst response = confirm(`Do you really want to delete ${schedule_name}?`);\n\tif (response) {\n\t\tdelete data.schedule_types[schedule_name];\n\t\t$('select_schedule').value = '';\n\t\tupdate_view();\n\t}\n});\n\n// Period add, copy, and remove\n$('add_period').addEventListener('click', () => {\n\tif (schedule) {\n\t\tschedule.periods.push({\n\t\t\tfriendly_name: '',\n\t\t\tstart: '00:00:00',\n\t\t\tend: '00:00:00',\n\t\t\tkind: {Class: ''},\n\t\t});\n\t}\n\n\tdisplayPeriods();\n});\n\n// Handle form changes\n$('schedule_friendly_name').addEventListener('change', event => {\n\tevent.target.value = event.target.value.trim();\n\n\tif (!event.target.value) {\n\t\talert('This value is required.');\n\t\tupdate_view();\n\t\treturn;\n\t}\n\n\tschedule.friendly_name = event.target.value;\n\tupdate_view();\n});\n$('schedule_code').addEventListener('change', event => {\n\tconst v = codeStr(event.target.value);\n\tevent.target.value = v;\n\n\tif (!v) {\n\t\talert('This value is required.');\n\t\tupdate_view();\n\t\treturn;\n\t}\n\n\tif (v === schedule_name) {\n\t\treturn;\n\t}\n\n\tif (!confirm('Changing the code of existing schedules can cause issues and is generally not recommended. Are you sure you want to change it?')) {\n\t\tevent.target.value = schedule_name;\n\t\treturn;\n\t}\n\n\tif (data.schedule_types[v]) {\n\t\talert('A schedule already exists with this code.');\n\t\tupdate_view();\n\t\treturn;\n\t}\n\n\tif (!v) {\n\t\tevent.target.value = schedule_name;\n\t\treturn;\n\t}\n\n\tdata.schedule_types[v] = schedule;\n\tdelete data.schedule_types[schedule_name];\n\tschedule_name = v;\n\tschedule = data.schedule_types[v];\n\tupdate_view();\n\t$('select_schedule').value = v;\n\tupdate_view();\n});\n\n$('schedule_color').addEventListener('change', event => {\n\tschedule.color = event.target.value\n\t\t.slice(1)\n\t\t.match(/.{2}/g)\n\t\t.map(x => Number.parseInt(x, 16));\n});\n\n$('schedule_hide').addEventListener('change', event => {\n\tschedule.hide = event.target.checked;\n});\n\n$('schedule_regex').addEventListener('change', event => {\n\ttry {\n\t\tconst regex = new RegExp(event.target.value);\n\t} catch {\n\t\talert('Invalid regular expression.');\n\t\tupdate_view();\n\t\treturn;\n\t}\n\n\tschedule.regex = event.target.value;\n});\n\n$('calendars').addEventListener('change', event => {\n\tconst items = event.target.value.split('\\n').map(x => x.trim()).filter(x => x).reverse();\n\n\tif (items.some(x => {\n\t\ttry {\n\t\t\tconst url = new URL(x);\n\t\t\treturn false;\n\t\t} catch {\n\t\t\treturn true;\n\t\t}\n\t})) {\n\t\talert('Invalid calendar URL.');\n\t\tupdate_view();\n\t\treturn;\n\t}\n\n\tdata.calendar_urls = items;\n\n\tupdate_view();\n});\n\n$('calendars').addEventListener('input', event => {\n\t$('calendars').setAttribute('rows', $('calendars').value.match(/\\n/g).length + 1);\n});\n\nconst template = $('period_settings');\n\nfunction displayPeriods() {\n\t$('periods').innerHTML = '';\n\tschedule.periods.forEach((period, i, arr) => {\n\t\tconst new_element = document.createElement('div');\n\t\tnew_element.classList.add('period');\n\t\tnew_element.innerHTML = template.innerHTML;\n\n\t\tfor (const element of new_element.querySelectorAll('[id]')) {\n\t\t\telement.id += `_${i}`;\n\t\t}\n\n\t\tfor (const element of new_element.querySelectorAll('[for]')) {\n\t\t\telement.for += `_${i}`;\n\t\t}\n\n\t\tconst $$ = id => new_element.querySelector(`#${id}_${i}`);\n\n\t\t$$('period_friendly_name').value = period.friendly_name;\n\t\t$$('period_start').value = period.start;\n\t\t$$('period_end').value = period.end;\n\t\tif (typeof period.kind === 'string') {\n\t\t\t$$('period_kind').value = period.kind;\n\t\t\t$$('period_class_index').disabled = true;\n\t\t} else {\n\t\t\t$$('period_kind').value = 'Class';\n\t\t\t$$('period_class_index').disabled = false;\n\t\t\t$$('period_class_index').value = period.kind.Class;\n\t\t}\n\n\t\t$$('move_up').disabled = i === 0;\n\t\t$$('move_down').disabled = i === arr.length - 1;\n\n\t\t$$('period_friendly_name').addEventListener('change', event => {\n\t\t\tevent.target.value = event.target.value.trim();\n\n\t\t\tif (!event.target.value) {\n\t\t\t\talert('This value is required.');\n\t\t\t\tupdate_view();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tperiod.friendly_name = event.target.value;\n\t\t});\n\t\t$$('period_start').addEventListener('change', event => {\n\t\t\tevent.target.value = event.target.value.trim();\n\n\t\t\tif (!event.target.value) {\n\t\t\t\talert('This value is required.');\n\t\t\t\tupdate_view();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (/^\\d{2}:\\d{2}$/.test(event.target.value)) {\n\t\t\t\tevent.target.value += ':00';\n\t\t\t}\n\n\t\t\tperiod.start = event.target.value;\n\t\t});\n\t\t$$('period_end').addEventListener('change', event => {\n\t\t\tevent.target.value = event.target.value.trim();\n\n\t\t\tif (!event.target.value) {\n\t\t\t\talert('This value is required.');\n\t\t\t\tupdate_view();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (/^\\d{2}:\\d{2}$/.test(event.target.value)) {\n\t\t\t\tevent.target.value += ':00';\n\t\t\t}\n\n\t\t\tperiod.end = event.target.value;\n\t\t});\n\t\t$$('period_kind').addEventListener('change', event => {\n\t\t\tif (event.target.value === 'Class') {\n\t\t\t\tperiod.kind = {\n\t\t\t\t\tClass: '',\n\t\t\t\t};\n\t\t\t\t$$('period_class_index').disabled = false;\n\t\t\t} else {\n\t\t\t\tperiod.kind = event.target.value;\n\t\t\t\t$$('period_class_index').value = '';\n\t\t\t\t$$('period_class_index').disabled = true;\n\t\t\t}\n\t\t});\n\t\t$$('period_class_index').addEventListener('change', event => {\n\t\t\tevent.target.value = event.target.value.trim();\n\n\t\t\tif (!event.target.value) {\n\t\t\t\talert('This value is required.');\n\t\t\t\tupdate_view();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.target.value === period.kind.Class) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (period.kind.Class && !confirm('Changing the code of existing periods can cause issues and is generally not recommended. Are you sure you want to change it?')) {\n\t\t\t\tevent.target.value = period.kind.Class;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tperiod.kind = {\n\t\t\t\tClass: event.target.value,\n\t\t\t};\n\t\t});\n\t\t$$('move_up').addEventListener('click', () => {\n\t\t\t[arr[i], arr[i - 1]] = [arr[i - 1], arr[i]];\n\t\t\tdisplayPeriods();\n\t\t});\n\t\t$$('move_down').addEventListener('click', () => {\n\t\t\t[arr[i], arr[i + 1]] = [arr[i + 1], arr[i]];\n\t\t\tdisplayPeriods();\n\t\t});\n\t\t$$('remove_period').addEventListener('click', () => {\n\t\t\tschedule.periods.splice(i, 1);\n\t\t\tdisplayPeriods();\n\t\t});\n\n\t\t$('periods').append(new_element);\n\t});\n}\n\nfunction codeStr(string) {\n\treturn (string || '')\n\t\t.toLowerCase()\n\t\t.trim()\n\t\t.replace(/\\s/g, '_');\n}\n\n$('export').addEventListener('click', () => {\n\tconst blob = new Blob([JSON.stringify(data)], {\n\t\ttype: 'application/json',\n\t});\n\n\tconst url = URL.createObjectURL(blob);\n\tconst a = document.createElement('a');\n\ta.href = url;\n\ta.download = 'def.json';\n\ta.click();\n\tURL.revokeObjectURL(url);\n});\n\n$('import').addEventListener('change', async event => {\n\tconst file = event.target.files[0];\n\tif (!file) {\n\t\treturn;\n\t}\n\n\tconst text = await file.text();\n\n\ttry {\n\t\tconst json = JSON.parse(text);\n\t\tdata = json;\n\t} catch {\n\t\talert('Invalid file contents');\n\t}\n\n\tevent.target.value = '';\n\tupdate_view();\n\n\talert('Imported settings.');\n});\n"],"names":["$ecc28d3d389a9c5b$var$data","$ecc28d3d389a9c5b$var$schedule_name","$ecc28d3d389a9c5b$var$schedule","$ecc28d3d389a9c5b$var$update_view","$","value","innerHTML","schedule_type","Object","keys","schedule_types","sort","a","b","friendly_name","localeCompare","disabled","el","document","querySelectorAll","$ecc28d3d389a9c5b$var$displayPeriods","color","map","x","toString","slice","join","checked","hide","regex","calendar_urls","reverse","setAttribute","match","length","i","day","entries","label","createElement","append","select","typical_schedule","addEventListener","br","async","confirm","fetch","json","res","method","body","JSON","stringify","headers","Authorization","ok","alert","status","statusText","new_name","$ecc28d3d389a9c5b$var$codeStr","prompt","periods","assign","push","start","end","kind","Class","event","target","trim","v","Number","parseInt","RegExp","items","split","filter","some","URL","$ecc28d3d389a9c5b$var$template","forEach","period","arr","new_element","classList","add","element","id","element1","for","$$","querySelector","test","splice","string","toLowerCase","replace","blob","Blob","type","url","createObjectURL","href","download","click","revokeObjectURL","file","files","text","parse"],"version":3,"file":"index.332c18d9.js.map"}